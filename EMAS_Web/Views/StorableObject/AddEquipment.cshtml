@model Model.Equipment
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@using Model
<style>
    .combobox {
        position: relative;
        display: inline-block;
        margin-bottom: 20px; /* Добавляем отступ между комбобоксами */
    }

    .combobox input {
        width: max-content;
        box-sizing: border-box;
    }

    .combobox ul {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        border: 1px solid #ccc;
        background: white;
        list-style: none;
        padding: 0;
        margin: 0;
        max-height: 150px;
        overflow-y: auto;
        display: none;
        z-index: 1; /* Устанавливаем z-index */
    }

    .combobox ul li {
        padding: 8px;
        cursor: pointer;
    }

    .combobox ul li:hover {
        background: #eee;
    }
</style>
<form method="post">
    <div>
        <p>
            <label asp-for="Type">Type</label><br />
            <input type="text" asp-for="Type" />
            <span asp-validation-for="Type" />
        </p>
        <p>
            <label asp-for="Name">Марка</label><br />
            <div class="combobox w-100">
                <input type="text" class="combobox-input form-control w-100" oninput="filterOptions(this)" asp-for="Name">
                <ul class="combobox-options">
                    @foreach (string manufacturer in ViewBag.DistinctValues[nameof(Equipment.Name)])
                    {
                        <li>@manufacturer</li>
                    }
                </ul>
            </div>
        </p>
        <p>
            <label asp-for="Units">Units</label><br />
            <input type="text" asp-for="Units" />
            <span asp-validation-for="Units" />
        </p>
        <p>
            <label asp-for="AccuracyClass">Accuracy Class</label><br />
            <input type="text" asp-for="AccuracyClass" />
            <span asp-validation-for="AccuracyClass" />
        </p>
        <p>
            <label asp-for="Limit">Limit</label><br />
            <input type="text" asp-for="Limit" />
            <span asp-validation-for="Limit" />
        </p>
        <p>
            <label asp-for="Manufacturer">Производитель</label><br />
            <div class="combobox w-100">
                <input type="text" class="combobox-input form-control w-100" oninput="filterOptions(this)" asp-for="Manufacturer">
                <ul class="combobox-options">
                    @foreach (string manufacturer in ViewBag.DistinctValues[nameof(Equipment.Manufacturer)])
                    {
                        <li>@manufacturer</li>
                    }
                </ul>
            </div>
        </p>
        <p>
            <label asp-for="FactoryNumber">Factory Number</label><br />
            <input type="text" asp-for="FactoryNumber" />
            <span asp-validation-for="FactoryNumber" />
        </p>
        <p>
            <label asp-for="RegistrationNumber">Registration Number</label><br />
            <input type="text" asp-for="RegistrationNumber" />
            <span asp-validation-for="RegistrationNumber" />
        </p>
        <p>
            <label asp-for="Status">Статус</label><br />
            <select class="form-select" name="Status">
                @foreach (KeyValuePair<int, string> status in ViewBag.Statuses)
                {
                    <option value="@status.Value">@status.Value</option>
                }
            </select>
        </p>
        <p>
            <label asp-for="Description">Description</label><br />
            <input type="text" asp-for="Description" />
            <span asp-validation-for="Description" />
        </p>
        <p>
            <input class="btn btn-success" type="submit" value="Создать новое оборудование" />
        </p>
    </div>

    @if (ViewBag.NoError != null)
    {
        @if (!ViewBag.NoError)
        {
            <div class="alert alert-danger" role="alert">
                @ViewBag.ErrorMessage
            </div>
        }
        else@if (ViewBag.NoError)
        {
            <div class="alert alert-success" role="alert">
                Добавление успешно
            </div>
        }
    }
    

</form>

@section Scripts
{
    <script>
        document.querySelectorAll('.combobox-input').forEach(input => {
            input.addEventListener('focus', () => {
                input.nextElementSibling.style.display = 'block';
            });

            input.addEventListener('blur', () => {
                setTimeout(() => {
                    input.nextElementSibling.style.display = 'none';
                }, 200);
            });
        });

        function filterOptions(input) {
            const filter = input.value.toLowerCase();
            const items = input.nextElementSibling.getElementsByTagName('li');
            for (let i = 0; i < items.length; i++) {
                const text = items[i].textContent || items[i].innerText;
                items[i].style.display = text.toLowerCase().includes(filter) ? '' : 'none';
            }
        }

        document.querySelectorAll('.combobox-options').forEach(options => {
            options.addEventListener('click', (e) => {
                if (e.target.tagName === 'LI') {
                    const input = options.previousElementSibling;
                    input.value = e.target.textContent;
                    console.log(e.target.textContent);
                    options.style.display = 'none';
                }
            });
        });
    </script>
}

<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.5.1.min.js"></script>
<script src="https://ajax.aspnetcdn.com/ajax/jquery.validate/1.17.0/jquery.validate.min.js"></script>
<script src="https://ajax.aspnetcdn.com/ajax/jquery.validation.unobtrusive/3.2.10/jquery.validate.unobtrusive.min.js"></script>